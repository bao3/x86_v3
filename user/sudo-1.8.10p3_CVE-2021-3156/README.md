# This is CVE-2021-3056 security patch for sudo 1.8.10p3 from Debian Jessie.

## Get the source from Debian Jessie repository

root@Jessie:~/test# apt-get source sudo

The source code will be located at /root/test/sudo-1.8.10p3

## Patch the sudo-1.8.10p3 with CVE-2021-3156

root@Jessie:~# cd sudo-1.8.10p3_aaa/
root@Jessie:~/sudo-1.8.10p3_aaa# patch -p1 < ../sudo-1.8.10p3_CVE-2021-3156/sudo-1.8.10p3_CVE-2021-3156-1.diff 
patching file src/parse_args.c
root@Jessie:~/sudo-1.8.10p3_aaa# patch -p1 < ../sudo-1.8.10p3_CVE-2021-3156/sudo-1.8.10p3_CVE-2021-3156-2.diff 
patching file plugins/sudoers/policy.c
root@Jessie:~/sudo-1.8.10p3_aaa# patch -p1 < ../sudo-1.8.10p3_CVE-2021-3156/sudo-1.8.10p3_CVE-2021-3156-3.diff 
patching file plugins/sudoers/sudoers.c
root@Jessie:~/sudo-1.8.10p3_aaa# patch -p1 < ../sudo-1.8.10p3_CVE-2021-3156/sudo-1.8.10p3_CVE-2021-3156-4.diff 

## Build the sudo 

root@Jessie:~/sudo-1.8.10p3_aaa# ./configure 
root@Jessie:~/sudo-1.8.10p3_aaa# make

## test the issue

moxa@Jessie:~$ sudoedit -s '\' `perl -e 'print "A" x 65536'`
sudoedit: unable to resolve host Jessie
Segmentation fault

## Install and then test this issue

root@Jessie:~/sudo-1.8.10p3_aaa# mv /usr/bin/sudo /usr/bin/sudo_orig
root@Jessie:~/sudo-1.8.10p3_aaa# cp -a src/sudo /usr/bin/

moxa@Jessie:~$ sudoedit -s '\' `perl -e 'print "A" x 65536'`
sudoedit: /usr/bin/sudoedit must be owned by uid 0 and have the setuid bit set
